KISSY.add("mobile/no-limit-scroll/1.0/index",function(d,h){var f=function(a){f.superclass.constructor.call(this,a);this.init(a)};f.ATTRS={wrap:{value:d.one("#km-scroll")},contentWrap:{value:d.one("#km-content")},trigMore:{value:d.one("#km-scroll-loading span")},loadStatus:{value:d.one("#km-scroll-status")},initWrapHeight:{value:function(){d.log("iscroll\u5305\u88f9\u5668\u8fd8\u6ca1\u6709\u521d\u59cb\u5316\u9ad8\u5ea6")}},getMoreInfo:{value:function(){d.log("\u4f60\u8fd8\u6ca1\u6709\u8bbe\u7f6e\u83b7\u53d6\u66f4\u591a\u4fe1\u606f\u7684\u65b9\u6cd5")}},threshold:{value:3},timer:{value:null},unitQueue:{value:[d.one(".km-scroll-unit").clone(!0)]},
unitHeightQueue:{value:[d.one(".km-scroll-unit").height()]},y:{value:0}};d.extend(f,d.Base,{init:function(){var a=this,b=d.one(".km-scroll-unit");b.css({height:b.height()+"px"});b=a.get("initWrapHeight").call(a);a.get("wrap").height(b);a.scrollObj=new h("km-scroll",{onScrollMove:function(){a.moveCallback(this)},onScrollEnd:function(){a.endCallback(this)},onBeforeScrollEnd:function(){}});a.bindEvent()},moveCallback:function(a){var b=this;b.get("timer")&&clearTimeout(b.timer);b.set("timer",setTimeout(function(){a.y<=
a.maxScrollY-20?(b.get("trigMore").addClass("hidden"),b.get("loadStatus").removeClass("hidden")):b.set("y",a.y)},100))},endCallback:function(a){this.get("trigMore").hasClass("hidden")?this.get("getMoreInfo").call(this):this.set("y",a.y)},bindEvent:function(){var a=this;a.get("trigMore").on("click",function(){d.one(this).addClass("hidden");a.get("loadStatus").removeClass("hidden");a.get("getMoreInfo").call(a)});a.on("afterYChange",function(b){a.YChangeHandler(b)})},YChangeHandler:function(a){if(!(this.get("unitHeightQueue").length<=
this.get("threshold"))){var b=a.newVal;a.prevVal>b?this.upScroll(b):this.downScroll(b)}},upScroll:function(a){for(var b=this.get("unitHeightQueue"),e=this.get("unitQueue"),a=Math.abs(a),c=0,g=d.all(".km-scroll-unit"),c=b.length;c--;)if(a>b[c]&&a<b[c+1]){c+=1;e[c-1]&&g.item(c-1).empty();e[c+1]&&!g.item(c+1).html()&&g.item(c+1).html(e[c+1].html());break}},downScroll:function(a){for(var b=this.get("unitHeightQueue"),e=this.get("unitQueue"),a=Math.abs(a),c=0,g=d.all(".km-scroll-unit"),c=this.scrollObj.wrapperH,
f=b.length;f--;)if(a>b[f]-c&&a<b[f+1]-c){c=f+1;e[c-1]&&!g.item(c-1).html()&&g.item(c-1).html(e[c-1].html());e[c+1]&&g.item(c+1).empty();break}},addContent:function(a){var b=this,e=d.one('<div class="km-scroll-unit">'+a+"</div>");this.get("contentWrap").append(e);d.later(function(){var c=e.height();b.addUnitQueue(a);b.addUnitHeightQueue(c);b.scrollObj.refresh();e.css("height",c+"px")},0)},addUnitQueue:function(a){var b=this.get("unitQueue");b.push(d.one('<div id="km-scroll-unit">'+a+"</div>"));this.set("unitQueue",
b)},addUnitHeightQueue:function(a){var b=this.get("unitHeightQueue");b.push(b[b.length-1]+a);this.set("unitHeightQueue",b)},resetLoad:function(){this.get("trigMore").removeClass("hidden");this.get("loadStatus").addClass("hidden")}});return f},{requires:["mobile/iscroll/","base","node","ajax"]});
